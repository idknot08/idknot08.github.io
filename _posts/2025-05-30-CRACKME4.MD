---
title: CrackMe4
date: 2025-05-29 01:01:01 +0700
categories: [RE, Patch]
tags: [trial, patching]
description: Patch chương trình để vượt qua giới hạn 30 ngày dùng thử bằng cách thay đổi giá trị số ngày trong lệnh khởi tạo.
---

# 🛠️ CrackMe4 – Vượt qua giới hạn dùng thử 30 ngày

---

## 🎯 Mục tiêu

1. **Bỏ giới hạn 30 ngày dùng thử** (hiển thị và logic thực thi)
2. **Chuyển thông tin trong About** thành còn rất nhiều ngày (đồng bộ với sửa đổi logic)

---

## 📌 Bước 1: Kiểm tra thông tin cơ bản

Sử dụng **Exeinfo PE**:

- PE32 (32-bit)
- Không bị pack
- Chạy ở chế độ GUI

📸

![Thông tin cơ bản trong Exeinfo PE](/resources/CrackMe4/Pasted%20image%2020250930165306.png)

---

## 📌 Bước 2: Chạy thử chương trình

Khi chạy file thực thi:

- Giao diện chính hiển thị cảnh báo ngày trial còn lại
- Mục **About** cũng hiển thị số ngày còn lại

📸

![Thông báo Trial](/resources/CrackMe4/Pasted%20image%2020250930165600.png)

![About hiển thị số ngày còn lại](/resources/CrackMe4/Pasted%20image%2020250930165632.png)

→ Có thể dùng các chuỗi “Trial Period has expired” để làm điểm bắt đầu phân tích trong IDA.

---

## 📌 Bước 3: Phân tích trong IDA

### 🔎 Tìm chuỗi

Tìm chuỗi `"Trial Period has expired"` trong IDA → truy ngược về **hàm `WinMain`**

📸

![Tìm chuỗi Trial trong IDA](/resources/CrackMe4/Pasted%20image%2020250930165836.png)

![WinMain chứa logic kiểm tra thời gian](/resources/CrackMe4/Pasted%20image%2020250930165938.png)

---

## 📌 Bước 4: Hiểu logic kiểm tra số ngày

Phân tích Assembly:

```asm
mov     ecx, 1Eh          ; 30 ngày
sub     ecx, eax          ; eax = số ngày đã sử dụng
mov     ?daysRemainingInt@@3HA, ecx
````

→ Chương trình tính `daysRemaining = 30 - currentDay`

✅ **Giải pháp:** Thay `1Eh` bằng `0FFh` → sẽ hiển thị số ngày rất lớn (255 ngày).

📸
![Thay đổi giá trị từ 1Eh sang FFh](/resources/CrackMe4/Pasted%20image%2020250930170335.png)

---

## 📌 Bước 5: Phân tích phần hiển thị trong About

Tìm chuỗi `"Trial Period has expired"` trong IDA, thấy nó nằm trong **hàm Callback**

📸

![Callback hiển thị số ngày](/resources/CrackMe4/Pasted%20image%2020250930170734.png)

![Callback được gọi trong WinMain](/resources/CrackMe4/Pasted%20image%2020250930170829.png)

* Hàm Callback lấy giá trị từ biến toàn cục `?daysRemainingInt@@3HA`
* Giá trị này đã được cập nhật trong **WinMain**

✅ → **Không cần sửa gì thêm**. Sửa tại bước 4 đã tác động luôn đến phần About.

---

## 💾 Bước 6: Lưu và kiểm thử

Lưu chương trình đã patch lại:

📸
![Lưu chương trình đã chỉnh sửa](/resources/CrackMe4/Pasted%20image%2020250930172424.png)

Chạy thử → chương trình hiển thị “Days Remaining: 255”

📸
![Hiển thị sau khi patch thành công](/resources/CrackMe4/Pasted%20image%2020250930172513.png)

---

## ✅ Kết luận

* CrackMe4 sử dụng cách tính số ngày dùng thử rất đơn giản: `daysRemaining = 30 - daysUsed`
* Việc patch cực kỳ nhẹ: chỉ cần **sửa 1 byte** (`1Eh` → `0FFh`)
* Phần hiển thị trong About sử dụng lại giá trị tính toán → **không cần sửa thêm**
