---
title: Sample.bin
date: 2025-07-15 15:08:56 +0700
categories: [Malware Analysis, Reverse Engineering]
tags: [autoit, backdoor, wacatac, unpack, memory-dump]
description: Ph√¢n t√≠ch b∆∞·ªõc ƒë·∫ßu m·∫´u AutoIt `sample.bin` (r√°p d·∫°ng Backdoor/Trojan.Agent.Wacatac) decompile AutoIt, bypass anti-debug, quan s√°t VirtualAlloc + dump v√πng nh·ªõ ƒë·ªÉ ti·∫øp t·ª•c gi·∫£i m√£.
---

# üîé Ph√¢n t√≠ch m·∫´u `sample.bin` (AutoIt ‚Äî Trojan.Agent.Wacatac)

**File:** `sample.bin`

**File type:** executable (AutoIt)

**MD5:** `66f33597cbf097345c51891ab951b641`

**VirusTotal:** Backdoor / Trojan.Agent.Wacatac

![VT detection](/resources/Sample-bin/Pasted%20image%2020251001150856.png)

---

## üßä 1. Ph√¢n t√≠ch tƒ©nh

**ExeinfoPE:** GUI, 32-bit, AutoIt.

![ExeinfoPE](/resources/Sample-bin/Pasted%20image%2020251001151054.png)

**PeStudio ‚Äî Indicators:** (embedded AutoIt, large RCData/.rdata, nhi·ªÅu imports m·∫°ng/WMIC/IpHelper).

![PeStudio indicators](/resources/Sample-bin/Pasted%20image%2020251001152108.png)

**Resources:** RCData ch·ª©a script AutoIt (decompile b·∫±ng `exe2aut` ‚Üí `sample_.au3`).

![RCData / script](/resources/Sample-bin/Pasted%20image%2020251001152224.png)

**Script (notable):** H√†m `mdfzjnyhbr()` n·ªëi chu·ªói (`$j = $j & ...`) ‚Äî obfuscation/concatenation.

![Obfuscated script snippet](/resources/Sample-bin/Pasted%20image%2020251001152806.png)

![Concatenation function](/resources/Sample-bin/Pasted%20image%2020251001153616.png)

---

## ‚öôÔ∏è 2. Ph√¢n t√≠ch ƒë·ªông (t√≥m t·∫Øt c√°c b∆∞·ªõc ƒë√£ th·ª±c hi·ªán)

- Ki·ªÉm tra anti-debug: ph√°t hi·ªán call `IsDebuggerPresent` t·∫°i `sub_403b3a` (file offset 0x2F7A). Khi ch·∫°y trong debugger, h√†m tr·∫£ 1 ‚Üí ch∆∞∆°ng tr√¨nh tho√°t. ƒê√£ ƒë·∫∑t breakpoint v√† s·ª≠a gi√° tr·ªã tr·∫£ v·ªÅ 0 ƒë·ªÉ ti·∫øp t·ª•c.
-
  ![IsDebuggerPresent hit](/resources/Sample-bin/Pasted%20image%2020251001155457.png)

  ![Patch breakpoint](/resources/Sample-bin/Pasted%20image%20202510011561251.png)

- Quan s√°t VirtualAlloc / VirtualAllocEx: 2 v√πng b·ªô nh·ªõ ƒë∆∞·ª£c c·∫•p v·ªõi quy·ªÅn **ERW**:
-
  - `Address = 0x01170000` ‚Äî Size ‚âà 0x35000 (ERW).
  -
  - `Address = 0x011C0000` ‚Äî Size ‚âà 0x35000 (ERW).

- Dump v√πng nh·ªõ th·ª© hai (`0x011C0000`) b·∫±ng ProcessHacker (v√πng m·ªôt ch·ª©a √≠t data, v√πng hai ch·ª©a payload ƒë√£ gi·∫£i m√£ h∆°n).
-
  ![ProcessHacker dump](/resources/Sample-bin/Pasted%20image%2020251001164403.png)

---

## ‚úÖ K·∫øt lu·∫≠n t·∫°m th·ªùi

- M·∫´u l√† **AutoIt executable** ch·ª©a script l·ªõn trong resources (.rdata/.rsrc) ‚Äî ƒë√£ decompile ra `sample_.au3`.
- C√≥ c∆° ch·∫ø **anti-debug** (IsDebuggerPresent).
- Th·ª±c hi·ªán **runtime unpack/decode** v√†o v√πng ERW (VirtualAlloc) ‚Äî dump v√πng nh·ªõ `0x011C0000` ƒë√£ thu th·∫≠p.
- H√†m n·ªëi `mdfzjnyhbr()` ch·ªãu tr√°ch nhi·ªám deobfuscation chu·ªói trong script.

---

## üìå IOC t·∫°m th·ªùi

| Lo·∫°i         | Gi√° tr·ªã                                                                         |
| ------------ | ------------------------------------------------------------------------------- |
| File name    | `sample.bin`                                                                    |
| MD5          | `66f33597cbf097345c51891ab951b641`                                              |
| Type         | AutoIt executable (embedded script)                                             |
| Notable      | `mdfzjnyhbr()` (string builder), anti-debug `IsDebuggerPresent` at `sub_403b3a` |
| Memory dumps | `sample_mem_011C0000.bin` (dump v√πng ERW)                                       |

---
