---
title: AutoIt Backdoor
date: 2025-09-15 16:30:00 +0700
categories: [Malware, Analysis]
tags: [autoit, backdoor, trojan, unpacking, debugging]
description: PhÃ¢n tÃ­ch tÄ©nh vÃ  Ä‘á»™ng máº«u AutoIt Backdoor (Trojan.Agent.Wacatac) â€“ tá»« nháº­n diá»‡n AutoIt script, bypass anti-debug, theo dÃµi VirtualAlloc vÃ  dump payload.
---

## ğŸ“Œ BÆ°á»›c 1: ThÃ´ng tin cÆ¡ báº£n

- **File Name**: `sample.bin`
- **File type**: Executable AutoIt
- **MD5**: `66f33597cbf097345c51891ab951b641`
- **VirusTotal**: PhÃ¡t hiá»‡n lÃ  dáº¡ng *Backdoor, Trojan.Agent.Wacatac*

ğŸ“¸

![VirusTotal detection](/resources/sample_autoit/Pasted image 20251001150856.png)

---

## ğŸ“Œ BÆ°á»›c 2: Kiá»ƒm tra báº±ng Exeinfo PE

Káº¿t quáº£ nháº­n dáº¡ng:

- GUI, 32-bit
- Äá»‹nh danh AutoIt

ğŸ“¸

![Exeinfo PE](/resources/sample_autoit/Pasted image 20251001151054.png)

---

## ğŸ“Œ BÆ°á»›c 3: PhÃ¢n tÃ­ch tÄ©nh vá»›i PeStudio

### ğŸ§­ 1. Indicators

ğŸ“¸

![PeStudio Indicators](/resources/sample_autoit/Pasted%20image%2020251001152108.png)

CÃ¡c cáº£nh bÃ¡o **Level 1** Ä‘Ã¡ng chÃº Ã½:

- `file > embedded,signature: AutoIt` (trong `.rdata` vÃ  `.rsrc`)
- Gá»i nhiá»u thÆ° viá»‡n há»‡ thá»‘ng:
  - Windows Socket 32-Bit Library
  - Windows Management Library
  - Multiple Provider Router Library
  - Internet Extensions for Win32 Library
  - Process Status Library
  - IP Helper API
- Sá»‘ lÆ°á»£ng imports cao: **161**

ğŸ‘‰ Äiá»u nÃ y gá»£i Ã½ máº«u nÃ y cÃ³ kháº£ nÄƒng giao tiáº¿p máº¡ng, quáº£n lÃ½ tiáº¿n trÃ¬nh, vÃ  Ä‘Ã£ bá»‹ **pack báº±ng AutoIt**.

---

### ğŸ§­ 2. Resource section

ğŸ“¸

![PeStudio Resources](/resources/sample_autoit/Pasted%20image%2020251001152224.png)

Trong `RCData` cÃ³ **script AutoIt** chá»©a **signature Ä‘áº·c trÆ°ng** â†’ Ä‘Ã¢y chÃ­nh lÃ  payload gá»‘c Ä‘Ã£ Ä‘Æ°á»£c Ä‘Ã³ng gÃ³i vÃ o resource.

---

## ğŸ“Œ BÆ°á»›c 4: Giáº£i nÃ©n AutoIt Script báº±ng Exe2Aut

Sá»­ dá»¥ng cÃ´ng cá»¥ `exe2aut` Ä‘á»ƒ decompile file AutoIt, káº¿t quáº£ thu Ä‘Æ°á»£c file `sample_.au3`.
Má»Ÿ báº±ng Notepad++ â†’ ná»™i dung lÃ  **má»™t script dÃ i** vá»›i nhiá»u hÃ m vÃ  lá»‡nh.

ğŸ“¸

![Script AutoIt giáº£i nÃ©n](/resources/sample_autoit/Pasted%20image%2020251001152806.png)

Äáº·c biá»‡t, cÃ³ hÃ m `mdfzjnyhbr()` vá»›i hÃ ng loáº¡t phÃ©p ná»‘i `&` trÃªn biáº¿n `$j`:

ğŸ“¸

![HÃ m mÃ£ hÃ³a chuá»—i](/resources/sample_autoit/Pasted%20image%2020251001153616.png)

ğŸ‘‰ ÄÃ¢y lÃ  ká»¹ thuáº­t **obfuscation chuá»—i**, giÃºp mÃ£ Ä‘á»™c trÃ¡nh bá»‹ Ä‘á»c dá»… dÃ ng.

---

## ğŸ“Œ BÆ°á»›c 5: PhÃ¢n tÃ­ch Ä‘á»™ng vá»›i IDA + x32dbg

Do khÃ´ng cÃ³ nhiá»u chuá»—i rÃµ rÃ ng, ta chuyá»ƒn sang cÃ¡ch tiáº¿p cáº­n **theo dÃµi API kháº£ nghi**.
Má»™t trong nhá»¯ng API Ä‘áº§u tiÃªn malware hay gá»i lÃ  `IsDebuggerPresent` Ä‘á»ƒ phÃ¡t hiá»‡n mÃ´i trÆ°á»ng debug.

ğŸ“¸

![IsDebuggerPresent](/resources/sample_autoit/Pasted%20image%2020251001155457.png)

API nÃ y náº±m táº¡i `sub_403B3A` â€“ **file offset 0x2F7A**.
Äáº·t breakpoint táº¡i Ä‘Ã¢y trong x32dbg â†’ khi cháº¡y:

ğŸ“¸

![BP IsDebuggerPresent](/resources/sample_autoit/Pasted%20image%2020251001161251.png)

- GiÃ¡ trá»‹ tráº£ vá» = 1 â†’ **chÆ°Æ¡ng trÃ¬nh phÃ¡t hiá»‡n debugger** vÃ  thoÃ¡t.
- Sá»­a káº¿t quáº£ tráº£ vá» thÃ nh `0` Ä‘á»ƒ **bypass anti-debug**.

---

## ğŸ“Œ BÆ°á»›c 6: Theo dÃµi VirtualAlloc Ä‘á»ƒ tÃ¬m payload

Sau khi bypass, malware tá»± giáº£i mÃ£ chÃ­nh nÃ³ â†’ ta theo dÃµi `VirtualAlloc` / `VirtualAllocEx`:

- **Láº§n 1**
  - Tráº£ vá» Ä‘á»‹a chá»‰: `0x01170000`
  - Quyá»n: `ERW` (Executable + Readable + Writable)
  - Size: `0x00035000`

Address=01170000
Size=00035000
Party=User
Allocation Type=PRV
Current Protection=ERW


- **Láº§n 2**
  - Tráº£ vá» Ä‘á»‹a chá»‰: `0x011C0000`
  - Quyá»n tÆ°Æ¡ng tá»± nhÆ° láº§n 1

ğŸ“¸
![Memory Dump vÃ¹ng 2](/resources/sample_autoit/Pasted%20image%2020251001164403.png)

ğŸ‘‰ ÄÃ¢y lÃ  cÃ¡c vÃ¹ng chá»©a **payload sau khi giáº£i mÃ£**.

---

## ğŸ“Œ BÆ°á»›c 7: Dump Payload

DÃ¹ng **Process Hacker** Ä‘á»ƒ dump toÃ n bá»™ vÃ¹ng nhá»› thá»© 2 (`0x011C0000`) ra file má»›i.
â†’ VÃ¹ng nÃ y chá»©a payload chÃ­nh, cÃ³ thá»ƒ tiáº¿p tá»¥c phÃ¢n tÃ­ch sÃ¢u hÆ¡n (unpacking, PE reconstruction, v.v.)

Do má»©c Ä‘á»™ phá»©c táº¡p cao â†’ bÃ i nÃ y táº¡m dá»«ng táº¡i bÆ°á»›c dump Ä‘á»ƒ táº­p trung vÃ o giai Ä‘oáº¡n giáº£i mÃ£ & bypass.

---

## âœ… Káº¿t luáº­n

- Máº«u `sample.bin` lÃ  **AutoIt-packed trojan/backdoor**, cÃ³ nhiá»u hÃ nh vi kháº£ nghi liÃªn quan Ä‘áº¿n máº¡ng vÃ  quáº£n lÃ½ tiáº¿n trÃ¬nh.
- **PeStudio** vÃ  **Exeinfo PE** giÃºp nháº­n dáº¡ng nhanh Ä‘á»‹nh dáº¡ng AutoIt.
- **Exe2Aut** cho phÃ©p láº¥y Ä‘Æ°á»£c script gá»‘c nhÆ°ng Ä‘Ã£ bá»‹ obfuscate chuá»—i.
- **Debug vá»›i x32dbg** vÃ  **theo dÃµi API** (IsDebuggerPresent, VirtualAlloc) giÃºp bypass anti-debug & tÃ¬m Ä‘Æ°á»£c vÃ¹ng giáº£i mÃ£.
- Dump vÃ¹ng nhá»› giÃºp cÃ³ thá»ƒ tiáº¿p tá»¥c phÃ¢n tÃ­ch sÃ¢u hÆ¡n (malware unpacking nÃ¢ng cao).

---

## ğŸ”— Ghi chÃº thÃªm

- AutoIt thÆ°á»ng Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ **Ä‘Ã³ng gÃ³i payload khÃ¡c** (dropper/loader).
- CÃ¡c bÆ°á»›c nhÆ° trÃªn cÃ³ thá»ƒ Ã¡p dá»¥ng cho nhiá»u máº«u AutoIt tÆ°Æ¡ng tá»±.
- CÃ³ thá»ƒ sá»­ dá»¥ng thÃªm Scylla hoáº·c x64dbg plugin Ä‘á»ƒ reconstruct PE tá»« vÃ¹ng nhá»› dump.

---
